<!DOCTYPE html>  <html> <head>   <title>autocomplete.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               autocomplete.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <h1>RegExp.escape</h1>

<p>Implementation via <a href="http://stackoverflow.com/questions/3561493/is-there-a-regexp-escape-function-in-javascript/3561711#3561711">StackOverflow</a></p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nb">RegExp</span><span class="p">.</span><span class="nv">escape = </span><span class="nf">(s) -&gt;</span> <span class="nx">s</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/[-\/\\^$*+?.()|[\]{}]/g</span><span class="p">,</span> <span class="s">&#39;\\$&amp;&#39;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h1>AutocompleteItem</h1>

<p>NOTE: recommended to be extended into another class</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">@</span><span class="p">.</span><span class="nx">AutocompleteItem</span> <span class="k">extends</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <h3>Public</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Return the JSON property name used to store the object's primary key.
Usually, this is a 'name' or 'key'. Subclasses can override this to
conform to their own JSON's idiosyncracies.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">key: </span><span class="o">-&gt;</span>
    <span class="s">&#39;name&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Test whether or not this object matches the given regexp. Subclasses
can override this to define a different matching algorithm.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">matches: </span><span class="nf">(regexp) -&gt;</span>
    <span class="nx">regexp</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">@completion</span><span class="p">())</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>The completion string for this object, quoted if it contains spaces.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">completion: </span><span class="o">-&gt;</span>
    <span class="nv">s = </span><span class="nx">@get</span><span class="p">(</span><span class="nx">@key</span><span class="p">())</span>
    <span class="nv">s = </span><span class="s">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="nx">s</span> <span class="o">+</span> <span class="s">&#39;&quot;&#39;</span> <span class="k">if</span> <span class="sr">/\s/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span>
    <span class="nx">@_prefixToken</span><span class="p">()</span> <span class="o">+</span> <span class="nx">s</span> <span class="o">+</span> <span class="nx">@_suffixToken</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>how to group the results</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">groupBy: </span><span class="o">-&gt;</span>
    <span class="nx">@get</span><span class="p">(</span><span class="s">&#39;kind&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="s">&#39;results&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <h3>Private</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>a prefix token, e.g. '[' or '#'</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">_prefixToken: </span><span class="o">-&gt;</span>
    <span class="nx">@get</span><span class="p">(</span><span class="s">&#39;token&#39;</span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">||</span> <span class="s">&#39;&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>a suffix token, e.g. ']'</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">_suffixToken: </span><span class="o">-&gt;</span>
    <span class="nx">@get</span><span class="p">(</span><span class="s">&#39;token&#39;</span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">||</span> <span class="s">&#39;&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <h1>AutocompleteItems</h1>

<p>NOTE: does not have to be extended, but can be</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">@</span><span class="p">.</span><span class="nx">AutocompleteItems</span> <span class="k">extends</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Collection</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <h3>Public</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>a collection of AutocompleteItem objects</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">model: </span><span class="nx">AutocompleteItem</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>sort autocomplete items by lowercase key asc</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">comparator: </span><span class="nf">(item) -&gt;</span>
    <span class="nx">item</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">key</span><span class="p">()).</span><span class="nx">toLowerCase</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>find autocomplete items matching the given regexp</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">matches: </span><span class="nf">(regexp) -&gt;</span>
    <span class="nx">@filter</span><span class="p">(</span><span class="nf">(item) -&gt;</span> <span class="nx">item</span><span class="p">.</span><span class="nx">matches</span><span class="p">(</span><span class="nx">regexp</span><span class="p">))</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <h3>Private</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>nothing yet</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <h1>AutocompleteItemView</h1>

<p>NOTE: does not have to be extended, but can be</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">@</span><span class="p">.</span><span class="nx">AutocompleteItemView</span> <span class="k">extends</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <h3>Public</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>autocomplete items are li elements</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">tagName: </span><span class="s">&#39;li&#39;</span>
  <span class="nv">className: </span><span class="s">&#39;autocomplete-item&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>initialize</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">initialize: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>re-render on model <code>change</code> events</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@model</span><span class="p">.</span><span class="kc">on</span> <span class="s">&#39;change&#39;</span><span class="p">,</span> <span class="nx">@render</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>subclasses should override this template function</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">template: </span><span class="nf">(obj) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>TODO should we throw an error instead to force people to subclass?
Or get template from AutocompleteItem objects?</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s">&quot;&lt;a href=\&quot;</span><span class="err">#</span><span class="s">\&quot;&gt;</span><span class="si">#{</span><span class="nx">obj</span><span class="p">.</span><span class="nx">markup</span><span class="si">}</span><span class="s">&lt;/a&gt;&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>render the template into @$el
TODO this is gross and needs to be re-done, but depends on where
@template() ends up living.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">render: </span><span class="nf">(regexp) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>munge some JSON</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">json = </span><span class="nx">@model</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">()</span>
    <span class="nv">json.markup = </span><span class="k">if</span> <span class="nx">regexp</span>
      <span class="nx">json</span><span class="p">[</span><span class="nx">@model</span><span class="p">.</span><span class="nx">key</span><span class="p">()].</span><span class="nx">replace</span><span class="p">(</span><span class="nx">regexp</span><span class="p">,</span> <span class="s">&#39;&lt;em&gt;$1&lt;/em&gt;&#39;</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="nx">json</span><span class="p">[</span><span class="nx">@model</span><span class="p">.</span><span class="nx">key</span><span class="p">()]</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>update @$el's html</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@$el</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">@template</span><span class="p">(</span><span class="nx">json</span><span class="p">))</span>

    <span class="nv">completion = </span><span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">@model</span><span class="p">.</span><span class="nx">completion</span><span class="p">())</span>
    <span class="nx">@$el</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s">&#39;data-autocomplete-completion&#39;</span><span class="p">,</span> <span class="nx">completion</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>return @ per Backbone.View convention</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <h3>Private</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>nothing yet</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <h1>AutocompleteItemsView</h1>

<p>NOTE: does not have to be extended, but can be</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">@</span><span class="p">.</span><span class="nx">AutocompleteItemsView</span> <span class="k">extends</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <h3>Public</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>optionally override this with subclasses of AutocompleteItemView</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">itemView: </span><span class="nx">AutocompleteItemView</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>events to which autocomplete responds to</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">events:</span></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>submitting the form</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s">&#39;submit form&#39;</span>                              <span class="o">:</span> <span class="s">&#39;_handleSubmit&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <p>keying into the input field</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s">&#39;keyup input[type=text]&#39;</span>                   <span class="o">:</span> <span class="s">&#39;_handleKeypress&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>focusing the input field should autocomplete results</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s">&#39;focus input[type=text]&#39;</span>                   <span class="o">:</span> <span class="s">&#39;showResults&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>blurring the input field hides autocomplete results</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s">&#39;blur input[type=text]&#39;</span>                    <span class="o">:</span> <span class="s">&#39;hideResults&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>hovering over an autocomplete result selects it
TODO why can't i use the <code>hover</code> event?</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s">&#39;mouseenter [data-autocomplete-completion]&#39;</span><span class="o">:</span> <span class="s">&#39;_selectResult&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>clicking on an autocomplete result finishes autocompleting
TODO why can't i use the <code>click</code> event?</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="s">&#39;mousedown [data-autocomplete-completion]&#39;</span> <span class="o">:</span> <span class="s">&#39;submit&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>initializes the autocomplete, and caches a few DOM elements for use later.
NOTE you must initialize this view with @$el already attached to the DOM.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">initialize: </span><span class="o">-&gt;</span>
    <span class="vi">@itemView = </span><span class="nx">@options</span><span class="p">.</span><span class="nx">itemView</span> <span class="k">if</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">itemView</span>
    <span class="nx">@_</span><span class="nv">$field = </span><span class="nx">@$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s">&#39;input[type=text]&#39;</span><span class="p">)</span>
    <span class="nx">@_</span><span class="nv">$form = </span><span class="nx">@$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s">&#39;form&#39;</span><span class="p">)</span>
    <span class="nx">@_</span><span class="nv">$resultsList = </span><span class="nx">@$el</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s">&#39;.autocomplete-results&#39;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>listens for autocomplete:clear to clear the input field</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@</span><span class="kc">on</span> <span class="s">&#39;autocomplete:clear&#39;</span><span class="p">,</span> <span class="o">=&gt;</span>
      <span class="nx">@_$field</span><span class="p">.</span><span class="nx">val</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p>listens for autocomplete:replace to replace contents of the input field</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@</span><span class="kc">on</span> <span class="s">&#39;autocomplete:replace&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nv">fragments = </span><span class="nx">@_fragments</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span>
      <span class="nx">@_$field</span><span class="p">.</span><span class="nx">val</span><span class="p">(</span><span class="nx">fragments</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">).</span><span class="nx">trim</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39; &#39;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p>listens for autocomplete:replace to append to contents of the input field</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@</span><span class="kc">on</span> <span class="s">&#39;autocomplete:append&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">=&gt;</span>
      <span class="nv">fragments = </span><span class="nx">@_fragments</span><span class="p">(</span><span class="nx">@_$field</span><span class="p">.</span><span class="nx">val</span><span class="p">()).</span><span class="nx">concat</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span>
      <span class="nx">@_$field</span><span class="p">.</span><span class="nx">val</span><span class="p">(</span><span class="nx">@_fragments</span><span class="p">(</span><span class="nx">fragments</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)).</span><span class="nx">join</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">).</span><span class="nx">trim</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39; &#39;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <p>render is a no-op because we require the DOM to already contain the
needed markup.
TODO discuss. should we have this class render markup completely?</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">render: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>return @ per Backbone.View convention</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@</span></pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p>this is a little tricky, but essentially it only submits the form after
giving it enough time to properly populate the input field.
TODO this method is kind of a gross hack. better way?</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">_handleSubmit: </span><span class="nf">(e, force = false) -&gt;</span>
    <span class="k">if</span> <span class="nx">force</span></pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p>submit the form if we really, really want to do so</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">return</span> <span class="kc">true</span>
    <span class="k">else</span></pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <p>re-trigger the submit after a small amount of time so autocomplete
finishes populating the form.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">_</span><span class="p">.</span><span class="nx">delay</span><span class="p">((</span><span class="o">=&gt;</span> <span class="nx">@_$form</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s">&#39;submit&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">)),</span> <span class="mi">100</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <p>return false to prevent form submit</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="kc">false</span></pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <p>finishes autocomplete, hides results, blurs the input, and submits the form</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">submit: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <p>finish autocomplete</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@_finishAutocomplete</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <p>hide autocomplete results</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@hideResults</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <p>blur the input field</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@_$field</span><span class="p">.</span><span class="nx">blur</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <p>submit the form</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@_handleSubmit</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <p>shows autocomplete results that match text inside the input field</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">showResults: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <p>show autocomplete results</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@_showAutocompleteResults</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>               <p>hides autocomplete results, also clearing the DOM element containing them</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">hideResults: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-59">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-59">&#182;</a>               </div>               <p>hide (and clear) autocomplete results</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@_$resultsList</span><span class="p">.</span><span class="nx">hide</span><span class="p">().</span><span class="nx">empty</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-60">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-60">&#182;</a>               </div>               <p>selects an autocomplete result at the given index</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">selectResult: </span><span class="nf">(i = 0) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-61">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-61">&#182;</a>               </div>               <p>clear 'selected' classes, then add it back to the desired result</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@_$resultsList</span><span class="p">.</span><span class="nx">children</span><span class="p">().</span><span class="nx">removeClass</span><span class="p">(</span><span class="s">&#39;selected&#39;</span><span class="p">).</span><span class="nx">filter</span><span class="p">(</span><span class="s">&quot;:eq(</span><span class="si">#{</span><span class="nx">i</span><span class="si">}</span><span class="s">)&quot;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s">&#39;selected&#39;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-62">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-62">&#182;</a>               </div>               <h3>Private</h3>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-63">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-63">&#182;</a>               </div>               <p>selects an autocomplete result from a given event (usually a mouseenter)</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">_selectResult: </span><span class="nf">(e) -&gt;</span>
    <span class="nv">$el = </span><span class="nx">$</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-64">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-64">&#182;</a>               </div>               <p>TODO kind of a gross hack. why is the event triggering on inner elements?
TODO don't hard code to 'li'</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">$el = </span><span class="k">if</span> <span class="nx">$el</span><span class="p">.</span><span class="o">is</span><span class="p">(</span><span class="s">&#39;li&#39;</span><span class="p">)</span> <span class="k">then</span> <span class="nx">$el</span> <span class="k">else</span> <span class="nx">$el</span><span class="p">.</span><span class="nx">closest</span><span class="p">(</span><span class="s">&#39;li&#39;</span><span class="p">)</span>

    <span class="nx">@selectResult</span><span class="p">(</span><span class="nx">@_$resultsList</span><span class="p">.</span><span class="nx">children</span><span class="p">().</span><span class="nx">index</span><span class="p">(</span><span class="nx">$el</span><span class="p">))</span></pre></div>             </td>           </tr>                               <tr id="section-65">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-65">&#182;</a>               </div>               <p>processes keypress events, performing one of the following:</p>

<ul>
<li>up/down arrow to select an autocomplete result item</li>
<li>escape to hide autocomplete results</li>
<li>enter to finish autocomplete and submit</li>
<li>other keys to match and display autocomplete results</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">_handleKeypress: </span><span class="nf">(e) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-66">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-66">&#182;</a>               </div>               <p>memoize a debounced implementation to be invoked later</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@_debouncedHandleKeypress</span> <span class="o">||=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">debounce</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span>

      <span class="k">switch</span> <span class="nx">e</span><span class="p">.</span><span class="nx">which</span></pre></div>             </td>           </tr>                               <tr id="section-67">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-67">&#182;</a>               </div>               <p>up/down arrow selects an autocomplete result</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">when</span> <span class="mi">38</span><span class="p">,</span> <span class="mi">40</span>
          <span class="nv">$items = </span><span class="nx">@_$resultsList</span><span class="p">.</span><span class="nx">children</span><span class="p">()</span>
          <span class="nv">$first = </span><span class="nx">$items</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s">&#39;:first-child&#39;</span><span class="p">)</span>
          <span class="nv">$last = </span><span class="nx">$items</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s">&#39;:last-child&#39;</span><span class="p">)</span>
          <span class="nv">$selected = </span><span class="nx">$items</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s">&#39;.selected&#39;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-68">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-68">&#182;</a>               </div>               <p>TODO is the following the most efficient way to do this?</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nv">$el =</span>
            <span class="k">if</span> <span class="nx">e</span><span class="p">.</span><span class="nx">which</span> <span class="o">is</span> <span class="mi">38</span>
              <span class="k">if</span> <span class="nx">$selected</span><span class="p">.</span><span class="o">is</span><span class="p">(</span><span class="s">&#39;:first-child&#39;</span><span class="p">)</span>
                <span class="nx">$last</span>
              <span class="k">else</span>
                <span class="nx">$selected</span><span class="p">.</span><span class="nx">prevAll</span><span class="p">(</span><span class="s">&#39;[data-autocomplete-completion]&#39;</span><span class="p">).</span><span class="nx">filter</span><span class="p">(</span><span class="s">&#39;:eq(0)&#39;</span><span class="p">)</span>
            <span class="k">else</span>
              <span class="k">if</span> <span class="nx">$selected</span><span class="p">.</span><span class="o">is</span><span class="p">(</span><span class="s">&#39;:last-child&#39;</span><span class="p">)</span>
                <span class="nx">$first</span>
              <span class="k">else</span>
                <span class="nx">$selected</span><span class="p">.</span><span class="nx">nextAll</span><span class="p">(</span><span class="s">&#39;[data-autocomplete-completion]&#39;</span><span class="p">).</span><span class="nx">filter</span><span class="p">(</span><span class="s">&#39;:eq(0)&#39;</span><span class="p">)</span>

          <span class="nx">@selectResult</span><span class="p">(</span><span class="nx">$items</span><span class="p">.</span><span class="nx">index</span><span class="p">(</span><span class="nx">$el</span><span class="p">))</span></pre></div>             </td>           </tr>                               <tr id="section-69">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-69">&#182;</a>               </div>               <p>escape key hides autocomplete results</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">when</span> <span class="mi">27</span>
          <span class="nx">@hideResults</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-70">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-70">&#182;</a>               </div>               <p>enter key finishes autocomplete and submits</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">when</span> <span class="mi">13</span>
          <span class="nx">@submit</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-71">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-71">&#182;</a>               </div>               <p>else, show matching autocomplete results</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">else</span>
          <span class="nx">@_showAutocompleteResults</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-72">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-72">&#182;</a>               </div>               <p>invoke the debounced version of this method</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@_debouncedHandleKeypress</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-73">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-73">&#182;</a>               </div>               <p>displays matching autocomplete results to the user</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">_showAutocompleteResults: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-74">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-74">&#182;</a>               </div>               <p>first, clear out all autocomplete results</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">@hideResults</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-75">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-75">&#182;</a>               </div>               <p>show autocomplete results if the field is non-empty
NOTE assume that we're always only autocompleting the <em>last</em> fragment</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nv">fragment = </span><span class="nx">_</span><span class="p">.</span><span class="nx">last</span><span class="p">(</span><span class="nx">@_fragments</span><span class="p">(</span><span class="nx">@_$field</span><span class="p">.</span><span class="nx">val</span><span class="p">()))).</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span></pre></div>             </td>           </tr>                               <tr id="section-76">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-76">&#182;</a>               </div>               <p>a regexp to match autocomplete items</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">regexp = </span><span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s">&quot;(</span><span class="si">#{</span><span class="nb">RegExp</span><span class="p">.</span><span class="nx">escape</span><span class="p">(</span><span class="nx">fragment</span><span class="p">)</span><span class="si">}</span><span class="s">)&quot;</span><span class="p">,</span> <span class="s">&#39;i&#39;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-77">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-77">&#182;</a>               </div>               <p>we want an "all results" link as the first autocomplete result
TODO we shouldn't actually use markup here... right?
TODO don't hard code to 'li'</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">@_$resultsList</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s">&#39;&lt;li class=&quot;autocomplete-item-all&quot; data-autocomplete-completion=&quot;#&quot;&gt;&lt;a href=&quot;#&quot;&gt;See all results&lt;/a&gt;&lt;/li&gt;&#39;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-78">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-78">&#182;</a>               </div>               <p>group autocomplete results</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">groups</span> <span class="o">=</span><span class="nx">_</span><span class="p">.</span><span class="nx">groupBy</span><span class="p">(</span><span class="nx">@collection</span><span class="p">.</span><span class="nx">matches</span><span class="p">(</span><span class="nx">regexp</span><span class="p">),</span> <span class="nf">(item) -&gt;</span> <span class="nx">item</span><span class="p">.</span><span class="nx">groupBy</span><span class="p">())</span></pre></div>             </td>           </tr>                               <tr id="section-79">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-79">&#182;</a>               </div>               <p>render grouped autocomplete results to the DOM</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">_</span><span class="p">.</span><span class="nx">each</span> <span class="nx">groups</span><span class="p">,</span> <span class="p">(</span><span class="nx">matches</span><span class="p">,</span> <span class="nx">group</span><span class="p">)</span> <span class="o">=&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-80">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-80">&#182;</a>               </div>               <p>TODO don't hard code to 'li'</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">@_$resultsList</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s">&quot;&lt;li class=\&quot;autocomplete-item-group\&quot;&gt;&lt;h5&gt;</span><span class="si">#{</span><span class="nx">group</span><span class="si">}</span><span class="s">&lt;/h5&gt;&lt;/li&gt;&quot;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-81">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-81">&#182;</a>               </div>               <p>iterate over matching results, rendering them to the DOM</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">_</span><span class="p">.</span><span class="nx">each</span> <span class="nx">matches</span><span class="p">,</span> <span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="o">=&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-82">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-82">&#182;</a>               </div>               <p>TODO if we want to keep it simple and optimize for speed, maybe
we should not use a Backbone.View here and instead just have
this view do the rendering. Discuss.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nv">v = </span><span class="k">new</span> <span class="nx">@itemView</span><span class="p">(</span><span class="nv">model: </span><span class="nx">item</span><span class="p">)</span>
          <span class="nv">$el = </span><span class="nx">v</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">regexp</span><span class="p">).</span><span class="nx">$el</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s">&quot;index-</span><span class="si">#{</span><span class="nx">i</span><span class="si">}</span><span class="s">&quot;</span><span class="p">)</span>
          <span class="nx">@_$resultsList</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">$el</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-83">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-83">&#182;</a>               </div>               <p>show the autocomplete results</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">@_$resultsList</span><span class="p">.</span><span class="nx">show</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-84">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-84">&#182;</a>               </div>               <p>automatically select the first autocomplete item</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">@selectResult</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-85">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-85">&#182;</a>               </div>               <p>finishes the autocomplete by replacing the typed-in fragment with the
full completion in the input field</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">_finishAutocomplete: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-86">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-86">&#182;</a>               </div>               <p>the completion of the autocomplete item selected by the user</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nv">completion = </span><span class="nb">decodeURIComponent</span><span class="p">(</span><span class="nx">@_$resultsList</span><span class="p">.</span><span class="nx">children</span><span class="p">(</span><span class="s">&#39;.selected&#39;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s">&#39;data-autocomplete-completion&#39;</span><span class="p">))</span></pre></div>             </td>           </tr>                               <tr id="section-87">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-87">&#182;</a>               </div>               <p>if there's a completion, update the input field by replacing the last
field fragment with the full completion</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="o">not</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isEmpty</span><span class="p">(</span><span class="nx">completion</span><span class="p">)</span> <span class="o">and</span> <span class="nx">completion</span> <span class="o">isnt</span> <span class="s">&#39;#&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-88">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-88">&#182;</a>               </div>               <p>new fragments</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nv">fragments = </span><span class="nx">@_fragments</span><span class="p">(</span><span class="nx">@_$field</span><span class="p">.</span><span class="nx">val</span><span class="p">()).</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">).</span><span class="nx">concat</span><span class="p">(</span><span class="nx">completion</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-89">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-89">&#182;</a>               </div>               <p>update the field</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">@_$field</span><span class="p">.</span><span class="nx">val</span><span class="p">(</span><span class="nx">@_fragments</span><span class="p">(</span><span class="nx">fragments</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)).</span><span class="nx">join</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">).</span><span class="nx">trim</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39; &#39;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-90">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-90">&#182;</a>               </div>               <p>split the input field's text into separate fragments</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nv">_fragments: </span><span class="nf">(s) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-91">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-91">&#182;</a>               </div>               <p>TODO using /\s+/ doesn't account for quoted multi-word items... maybe OK?</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">_</span><span class="p">.</span><span class="nx">uniq</span><span class="p">(</span><span class="nx">s</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="sr">/\s+/</span><span class="p">))</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 